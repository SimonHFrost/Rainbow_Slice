<html>
	<head>
		<title>Roller Ball</title>
		<style>canvas { width: 100%; height: 100% }</style>
	</head>
	<body>
    <script src="https://rawgithub.com/mrdoob/three.js/master/build/three.js"></script>
    <script src="https://rawgithub.com/mrdoob/three.js/master/examples/js/effects/AsciiEffect.js"></script>
    <script src="keyboard.js"></script>

		<script>
			var container, stats;
			var camera, scene, renderer;
			var sphere, plane;
			var start = Date.now();

			var ASCIIFY = false;

			init();
			animate();

			function init() {
				var width = window.innerWidth || 2 - 20;
				var height = window.innerHeight || 2 - 20;

				container = document.createElement( 'div' );
				document.body.appendChild( container );

				camera = new THREE.PerspectiveCamera( 45, width / height, 1, 2500 );
				camera.position.y = 2000;
				camera.rotation.x = -1.57; // -90 degrees in rads

				scene = new THREE.Scene();

				var pointLight = new THREE.PointLight( 0xffffff );
				pointLight.position.set( 500, 500, 500 );
				scene.add( pointLight );

				var ambientLight = new THREE.AmbientLight( 0x404040 );
				scene.add( ambientLight );

				initSceneObjects();

				renderer = new THREE.CanvasRenderer();
				renderer.setSize( width, height );

				// ASCII Effect
				effect = new THREE.AsciiEffect( renderer );
				effect.setSize( width, height );
				if(ASCIIFY) {
					container.appendChild( effect.domElement );
				} else {
					container.appendChild(renderer.domElement);
				}

				window.addEventListener( 'resize', onWindowResize, false );
      }

			function initSceneObjects() {
				// Sphere
				sphere = new THREE.Mesh( new THREE.SphereGeometry( 100, 20, 10 ), new THREE.MeshLambertMaterial( { shading: THREE.FlatShading } ) );
				scene.add( sphere );

				// Floor
				var floorWidth = window.innerWidth * 2;
				var floorHeight = window.innerHeight * 2;
				var textureSize = 256;

				var material
				if (ASCIIFY) {
					material = new THREE.MeshBasicMaterial( { color: 0xE0E0E0 } );
				} else {
					texture = THREE.ImageUtils.loadTexture('grass.jpg');
					texture.wrapS = THREE.RepeatWrapping;
					texture.wrapT = THREE.RepeatWrapping;
					texture.repeat.set( floorWidth / textureSize, floorHeight / textureSize );
					material = new THREE.MeshBasicMaterial({map: texture});
				}
				floor = new THREE.Mesh( new THREE.PlaneGeometry( floorWidth, floorHeight ), material );
				floor.position.y = - 200;
				floor.rotation.x = - Math.PI / 2;
				scene.add( floor );

				// Wall
				wall = new THREE.Mesh( new THREE.PlaneGeometry( 3000, 3000 ), new THREE.MeshBasicMaterial( { color: 0xA0A0A0} ));
				wall.position.y = - 200;
				wall.position.z = - 200;
				scene.add( wall );
			}

			function onWindowResize() {
				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();

				renderer.setSize( window.innerWidth, window.innerHeight );
				if(ASCIIFY) {
					effect.setSize( window.innerWidth, window.innerHeight );
				}
			}

			function animate() {
				requestAnimationFrame( animate );

				render();
			}

			function render() {
				var timer = Date.now() - start;

				var rotationSpeed = 0.1;
				var translationSpeed = 15;

				if (Key.isDown(Key.A)) {
        	sphere.position.x -= translationSpeed;
					sphere.rotation.z += rotationSpeed;
        }

				if (Key.isDown(Key.D)) {
					sphere.position.x += translationSpeed;
					sphere.rotation.z -= rotationSpeed;
				}

				if (Key.isDown(Key.W)) {
					sphere.position.z -= translationSpeed;
					sphere.rotation.x -= rotationSpeed;
				}

				if (Key.isDown(Key.S)) {
					sphere.position.z += translationSpeed;
					sphere.rotation.x += rotationSpeed;
				}

				effect.render( scene, camera );
			}

		</script>
	</body>
</html>
